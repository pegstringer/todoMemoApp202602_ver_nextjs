# ToDoメモアプリ テスト解説書

この文書は、プログラミング初心者の方が「今回のテスト作業で何が行われたのか」を理解し、今後の学習に役立てるためのガイドです。

---

## 目次

- [第1章: そもそもの用語を理解する](#第1章-そもそもの用語を理解する)
- [第2章: このアプリの全体像](#第2章-このアプリの全体像)
- [第3章: テストで「何を」「なぜ」検証したのか](#第3章-テストで何をなぜ検証したのか)
- [第4章: テストの結果をどう読むか](#第4章-テストの結果をどう読むか)
- [第5章: ユーザーとしてどう評価・判断すればよいか](#第5章-ユーザーとしてどう評価判断すればよいか)
- [第6章: ここからどう学べばいいか](#第6章-ここからどう学べばいいか)

---

## 第1章: そもそもの用語を理解する

> **この章で分かること:** 「TSXファイル」「テストコード」「Vitest」という言葉が何を意味するのか

### TSXファイルとは

普通のウェブページはHTMLという言語で書かれています。たとえばこんな感じです。

```html
<button>追加</button>
```

TSXファイルは、このHTMLに「動き」を加えたものです。ボタンを押したときに何が起きるか、入力欄に何を表示するかといった**ふるまい**もセットで書けます。

たとえばこのアプリでは「追加」ボタンを押すとToDoが追加されますが、「ボタンの見た目」と「押したときの動作」が1つのTSXファイルにまとまっています。

つまり **TSXファイル = 画面の部品（見た目＋動き）** です。

このアプリには4つの部品があります。

| ファイル名 | 何の部品か |
|---|---|
| `TodoForm.tsx` | タイトルとメモを入力して「追加」するフォーム |
| `TodoItem.tsx` | 1つのToDoの表示（チェック、削除、メモ編集） |
| `TodoList.tsx` | ToDoの一覧表示 |
| `TodoFilter.tsx` | 「すべて」「未完了」「完了済み」の切り替えボタン |

### テストコードとは

テストコードは、**アプリが正しく動くかを自動で確認してくれるプログラム**です。

たとえ話で説明します。

あなたが料理を作ったとします。料理が完成したあと、こんなことを確認しますよね。

- 塩加減は大丈夫？
- 火は通っている？
- 盛り付けはきれい？

この確認作業を**毎回あなた自身が手動でやる**のが、テストなしの状態です。

テストコードがあると、**ロボットが毎回この確認を代わりにやってくれます**。しかも1秒で54項目チェックできます。

人間が手動で確認すると、以下の問題があります。

- 全ページを毎回クリックして回るのは大変
- 「この前は確認したから大丈夫だろう」と油断する
- 変更したつもりがないところが壊れていても気づかない

テストコードはこれらを防いでくれます。

### Vitestとは

Vitestは**テストコードを動かすための道具（ツール）** です。

テストコードは書いただけでは動きません。「このテストを実行して、結果を教えて」と指示する仕組みが必要です。それがVitestです。

料理のたとえで言えば、テストコードが「レシピどおりにできているかのチェックリスト」で、Vitestが「チェックリストを実際に読んで検査してくれる検査員」です。

### なぜテストが必要なのか

アプリに新しい機能を追加したとき、既存の機能が壊れることがあります。これを**デグレード（退行）** と呼びます。

たとえば「メモ編集機能を改良した」ときに、意図せず「ToDo追加」が動かなくなることがあります。テストがあれば、変更後にテストを実行するだけで「他の機能は壊れていない」と確認できます。

---

## 第2章: このアプリの全体像

> **この章で分かること:** アプリがどんなファイルで構成されていて、データがどう流れるのか

### アプリの構造を「レストラン」で考える

このアプリを1つのレストランに例えてみます。

```
レストランの構造

   お客様（ユーザー）
       ↓ 注文（入力・クリック）
   ホールスタッフ（page.tsx）
       ↓ 注文を伝える
   シェフ（useTodos.ts）
       ↓ 料理を作る（データ操作）
   冷蔵庫（localStorage）
       ↓ 保存・取り出し
   ホールスタッフ → お客様に料理を提供（画面表示）
```

| 役割 | ファイル | やっていること |
|---|---|---|
| ホールスタッフ | `page.tsx` | 画面全体をまとめて、部品を配置する |
| 注文票の書式 | `todo.ts`（型定義） | ToDoデータの形を決める（タイトル、メモ、完了状態など） |
| シェフ | `useTodos.ts`（フック） | データの追加・削除・編集・フィルタリングを担当 |
| 注文フォーム | `TodoForm.tsx` | 新しいToDoを入力する部品 |
| 料理1皿 | `TodoItem.tsx` | 1つのToDoの表示と操作の部品 |
| お盆（トレイ） | `TodoList.tsx` | ToDoの一覧を並べて表示する部品 |
| メニューの切り替え | `TodoFilter.tsx` | 表示するToDoの種類を選ぶ部品 |
| 冷蔵庫 | `localStorage` | ブラウザにデータを保存する仕組み |

### データの流れ

ユーザーが「買い物」というToDoを追加する場面を追ってみましょう。

1. ユーザーがタイトル欄に「買い物」と入力し、「追加」ボタンを押す
2. **TodoForm** が入力値を受け取り、余計な空白を取り除く
3. **useTodos（シェフ）** が新しいToDoデータを作り、一覧の先頭に追加する
4. **localStorage（冷蔵庫）** にデータが自動保存される
5. **TodoList → TodoItem** を通じて画面に「買い物」が表示される

ページを閉じても、次にアプリを開いたとき **localStorage から復元** されるので、データは消えません。

---

## 第3章: テストで「何を」「なぜ」検証したのか

> **この章で分かること:** 54個のテストそれぞれが何を確認しているのか、そしてなぜその確認が必要なのか

### テスト全体の一覧

| テストファイル | 何をテストしているか | テスト数 |
|---|---|---|
| `TodoFilter.test.tsx` | フィルタボタンの表示とクリック | 6 |
| `TodoList.test.tsx` | 一覧の表示と空状態 | 5 |
| `TodoForm.test.tsx` | 入力フォームの動作 | 8 |
| `TodoItem.test.tsx` | 1つのToDoの表示・操作・メモ編集 | 17 |
| `useTodos.test.ts` | データ管理の全操作 | 18 |
| **合計** | | **54** |

以下、各テストファイルを詳しく見ていきます。

---

### 3-1. TodoFilter（フィルタボタン）のテスト — 6件

フィルタボタンは「すべて」「未完了」「完了済み」の3つのボタンです。

| テスト名 | 何を確認しているか | なぜ必要か |
|---|---|---|
| 3つのフィルタボタンが表示される | ボタンが画面に存在する | ボタンが出ないと何も操作できない |
| 「すべて」をクリックすると "all" が渡される | 正しい値が伝わる | 間違った値だとフィルタが狂う |
| 「未完了」をクリックすると "active" が渡される | 同上 | 同上 |
| 「完了済み」をクリックすると "completed" が渡される | 同上 | 同上 |
| 選択中のボタンにアクティブスタイルが適用される | 見た目で「今どれを選んでいるか」分かる | ユーザーが迷わないための表示確認 |
| 非選択ボタンに非アクティブスタイルが適用される | 選択していないボタンの見た目 | 選択中ボタンとの区別がつく |

---

### 3-2. TodoList（一覧表示）のテスト — 5件

| テスト名 | 何を確認しているか | なぜ必要か |
|---|---|---|
| 空のとき「ToDoがありません」と表示する | 何もないときの表示 | 真っ白な画面だとユーザーが困る |
| 空のときチェックボックスは表示されない | 余計な部品がない | 操作できないものが見えると混乱する |
| 1件のときタイトルが表示される | データが画面に出る | これが動かないとアプリとして成立しない |
| 3件あるとき全件表示される | 複数件の表示 | 1件だけ動いて3件だと壊れる、ということがないか |
| チェックボックスをクリックすると正しいIDで呼ばれる | クリックが正しいToDoに紐づく | 別のToDoが完了になったら大問題 |

---

### 3-3. TodoForm（入力フォーム）のテスト — 8件

| テスト名 | 何を確認しているか | なぜ必要か |
|---|---|---|
| 初期状態で追加ボタンが無効 | 空のまま追加できない | 空のToDoが作られるのを防ぐ |
| タイトル入力でボタンが有効になる | 入力に反応する | ボタンがずっと押せないと困る |
| 空白だけでは無効のまま | スペースだけは空と同じ扱い | 「　」というToDoが作られるのを防ぐ |
| 送信時にトリミングされた値で呼ばれる | 前後の空白が取り除かれる | 「　買い物　」が「買い物」になる |
| 送信後に入力欄がクリアされる | 次の入力の準備 | 前のテキストが残っていると不便 |
| メモなしでも送信できる | メモは任意 | メモを強制されると面倒 |
| 空のままEnterを押しても何も起きない | 誤送信の防止 | うっかりEnterを押しても安全 |
| Enterキーで送信できる | キーボード操作 | マウスがなくても使える |

---

### 3-4. TodoItem（1つのToDoの表示と操作）のテスト — 17件

最も多くのテストがあります。それだけこの部品が複雑だということです。

**表示に関するテスト（6件）**

| テスト名 | 何を確認しているか |
|---|---|
| タイトルが表示される | 基本表示 |
| メモがある場合はメモが表示される | メモの表示 |
| メモが空なら表示されない | 余計な空欄が出ない |
| 未完了は打ち消し線なし | 普通に読める |
| 完了済みは打ち消し線あり | 「終わった」と視覚的に分かる |
| 完了済みは薄い色になる | 未完了との区別がつく |

**チェックボックスのテスト（3件）**

| テスト名 | 何を確認しているか |
|---|---|
| クリックすると正しいIDで呼ばれる | 完了/未完了の切り替えが正しいToDoに対して行われる |
| 未完了はチェックなし | 表示と実際の状態が一致 |
| 完了済みはチェックあり | 表示と実際の状態が一致 |

**削除のテスト（1件）**

| テスト名 | 何を確認しているか |
|---|---|
| 削除ボタンで正しいIDが渡される | 間違ったToDoが消えるのを防ぐ |

**メモ編集のテスト（7件）**

| テスト名 | 何を確認しているか |
|---|---|
| メモがないとき「メモを追加」と表示 | ボタンの文言が状況に応じて変わる |
| メモがあるとき「メモを編集」と表示 | 同上 |
| クリックで編集モードになる | テキスト入力欄と保存・キャンセルボタンが出る |
| 入力して保存すると更新される | メモの新規追加が動く |
| 既存メモを書き換えて保存できる | メモの上書きが動く |
| キャンセルすると元に戻る | 間違えても安心 |
| 保存後に編集モードが閉じる | 画面が元に戻る |

---

### 3-5. useTodos（データ管理）のテスト — 18件

これはアプリの「頭脳」にあたる部分です。画面には直接見えませんが、すべてのデータ操作を担っています。

**初期化のテスト（4件）**

| テスト名 | 何を確認しているか | なぜ必要か |
|---|---|---|
| localStorageからデータを読み込む | 前回のデータが復元される | アプリを開くたびに消えたら困る |
| 空なら空配列 | 初回起動で問題なし | エラーで止まらない |
| 壊れたデータなら空配列に戻す | データ破損時の対処 | アプリが起動不能にならない |
| 読み込み完了フラグがtrueになる | 準備ができた合図 | 読み込み中の画面を正しく制御 |

**保存のテスト（1件）**

| テスト名 | 何を確認しているか |
|---|---|
| 追加するとlocalStorageに保存される | データが永続化される |

**追加のテスト（3件）**

| テスト名 | 何を確認しているか |
|---|---|
| タイトルとメモで新しいToDoが先頭に追加 | 新しいものが一番上に来る |
| 複数追加しても順序が正しい | 追加するたび先頭に来る |
| メモ空でも追加できる | メモは任意 |

**削除のテスト（2件）**

| テスト名 | 何を確認しているか |
|---|---|
| 指定IDが削除される | 正しいToDoだけ消える |
| 存在しないIDでも問題なし | エラーで止まらない |

**完了切り替えのテスト（3件）**

| テスト名 | 何を確認しているか |
|---|---|
| 未完了→完了 | チェックが入る |
| 完了→未完了 | チェックが外れる |
| 他のToDoは影響を受けない | 1つ変えても他が巻き添えにならない |

**メモ更新のテスト（2件）**

| テスト名 | 何を確認しているか |
|---|---|
| メモが更新される | 書き換え機能 |
| 空文字に更新できる | メモの削除相当 |

**フィルタリングのテスト（3件）**

| テスト名 | 何を確認しているか |
|---|---|
| "all" で全件表示 | フィルタなし |
| "active" で未完了のみ | 完了済みが非表示 |
| "completed" で完了済みのみ | 未完了が非表示 |

---

## 第4章: テストの結果をどう読むか

> **この章で分かること:** テスト実行時の画面出力の意味と、合格・不合格の読み方

### テストの実行方法

ターミナル（VS Codeの下部にある黒い画面）で以下を入力します。

```
npm run test:run
```

### 合格した場合の出力

```
 ✓ src/__tests__/hooks/useTodos.test.ts (18 tests) 22ms
 ✓ src/__tests__/components/TodoItem.test.tsx (17 tests) 290ms
 ✓ src/__tests__/components/TodoForm.test.tsx (8 tests) 252ms
 ✓ src/__tests__/components/TodoFilter.test.tsx (6 tests) 111ms
 ✓ src/__tests__/components/TodoList.test.tsx (5 tests) 109ms

 Test Files  5 passed (5)
       Tests  54 passed (54)
    Duration  1.07s
```

**読み方:**

- **✓（緑のチェック）** = そのファイルのテストが全部合格
- **`(18 tests)`** = そのファイルに18個のテストがある
- **`22ms`** = 実行にかかった時間（22ミリ秒 = 0.022秒）
- **`5 passed (5)`** = 5ファイル中5ファイル合格
- **`54 passed (54)`** = 54テスト中54テスト合格
- **`Duration 1.07s`** = 全体で約1秒

**54個のテストが1秒で完了**しています。これを人間が手動で確認したら何分かかるでしょうか？

### 不合格があった場合の出力

もし何か壊れていると、こんな表示になります。

```
 ✓ src/__tests__/hooks/useTodos.test.ts (18 tests)
 ❯ src/__tests__/components/TodoForm.test.tsx (8 tests | 1 failed)
     ✓ 初期状態で追加ボタンが無効になっている
     ✓ タイトルを入力すると追加ボタンが有効になる
     × 送信後にタイトルとメモの入力欄がクリアされる    ← ここが失敗

 Test Files  1 failed | 4 passed (5)
       Tests  1 failed | 53 passed (54)
```

**読み方:**

- **×（赤のバツ）** = そのテストが不合格
- **`1 failed`** = 1つ失敗している
- バツのすぐ下に「なぜ失敗したか」の詳細が表示される

**失敗した場合にやること:**

1. **どのテストが失敗したか** をテスト名で確認する
2. 失敗の詳細メッセージを読む（「期待値は○○だったが、実際は△△だった」と書いてある）
3. そのテストに関連するソースコード（本番のコード）を確認する
4. 原因を修正して、もう一度テストを実行する

### 詳細な結果を見たい場合

テスト名まで全部表示したいときは以下を使います。

```
npx vitest run --reporter=verbose
```

すると54個のテスト名がすべて一覧で表示されます。

---

## 第5章: ユーザーとしてどう評価・判断すればよいか

> **この章で分かること:** テスト結果を見て「これは良い」「これは不十分」を判断する方法

### 判断ポイント 1: テストは「何を」確認しているか

「54テスト全パス」という結果は良い兆候ですが、**数だけでは判断できません**。

大切なのは「意味のある項目をテストしているか」です。

**良いテストの例（このアプリで実際にやっていること）:**

- 「空白だけのタイトルでは追加ボタンが無効のまま」 → ユーザーが実際に遭遇する状況を確認
- 「キャンセルすると変更が元に戻る」 → 誤操作からの復帰を確認
- 「壊れたデータなら空配列に戻す」 → 異常な状況でもアプリが動く

**悪いテストの例（このアプリではやっていない）:**

- 「1 + 1 が 2 である」 → アプリと無関係
- 「ボタンのclass名が"btn-primary"である」 → 見た目の実装方法を確認しているだけ
- 「console.logが呼ばれる」 → デバッグ用のコードをテストしても意味がない

### 判断ポイント 2: 「正常系」と「異常系」の両方があるか

- **正常系** = 普通に使ったときに正しく動くか
- **異常系** = 変なことが起きたときに壊れないか

| 種類 | このアプリでの例 |
|---|---|
| 正常系 | タイトルを入力して追加 → ToDoが表示される |
| 異常系 | localStorageに壊れたデータがある → エラーにならず空で始まる |
| 境界値 | 空白だけの入力 → 追加ボタンが無効 |

良いテストは**両方をカバー**しています。このアプリのテストには正常系・異常系・境界値が含まれています。

### 判断ポイント 3: テストが全部通っている ≠ バグがゼロ

テストは「確認した項目」については保証しますが、**確認していない項目については何も言えません**。

たとえば、このテストでは以下のことは**確認していません**。

- スマートフォンでの表示崩れ
- 1000件のToDoを追加したときの速度
- インターネットが切れたときの動作
- ブラウザの「戻る」ボタンを押したときの挙動

テストが全部通っていることは「テストした範囲は問題ない」という意味です。**万能ではないが、ないよりはるかに安全**、というのが正しい理解です。

### 判断ポイント 4: CLAUDE.mdの原則に沿っているか

CLAUDE.mdに書いたテスト原則を使って、実際のテストを点検できます。

| 原則 | 今回のテストは守れているか |
|---|---|
| 意味のないアサーションは書かない | はい。全テストが実際の機能を検証している |
| 具体的な入力と出力を検証 | はい。「"買い物"を入力→"買い物"が表示」のように具体値 |
| モックは最小限 | はい。localStorage, UUID, 時刻の3つのみ |
| テスト用ハードコードをしない | はい。本番コードにテスト用の条件分岐はない |
| テストケース名が明確 | はい。日本語で「何を確認しているか」が分かる |

---

## 第6章: ここからどう学べばいいか

> **この章で分かること:** この経験を土台にして、次に何をすれば理解が深まるか

### ステップ1: テスト結果を自分で実行してみる

まずはターミナルでテストを実行し、結果が全部緑になることを自分の目で確認しましょう。

```
npm run test:run
```

### ステップ2: テストを「壊して」みる

理解を深める最良の方法は、**わざとテストを失敗させてみる**ことです。

**実験1: ソースコードを壊す**

`src/components/TodoForm.tsx` を開いて、以下の行を変えてみましょう。

```typescript
// 変更前
disabled={!title.trim()}

// 変更後（!を削除）
disabled={title.trim()}
```

そのあとテストを実行すると、失敗するテストが出ます。**どのテストが失敗して、なぜ失敗したか**を読んでみましょう。

確認が終わったら、**必ず元に戻してください**。

**実験2: テストコードの期待値を変える**

`src/__tests__/components/TodoFilter.test.tsx` を開いて、以下を変えてみましょう。

```typescript
// 変更前
expect(onChange).toHaveBeenCalledWith('active')

// 変更後（値を変える）
expect(onChange).toHaveBeenCalledWith('completed')
```

これでテストが失敗します。表示されるエラーメッセージを読むと「期待したのは"completed"だが、実際に呼ばれたのは"active"だった」と教えてくれます。

確認が終わったら、**必ず元に戻してください**。

### ステップ3: コードを読む順序

以下の順番で読むと、簡単なものから複雑なものへ段階的に理解できます。

1. **`src/types/todo.ts`** — データの形（5行だけ）
2. **`src/components/TodoFilter.tsx`** — 最もシンプルな部品
3. **`src/__tests__/components/TodoFilter.test.tsx`** — そのテスト
4. **`src/components/TodoForm.tsx`** — フォームの部品
5. **`src/__tests__/components/TodoForm.test.tsx`** — そのテスト
6. **`src/hooks/useTodos.ts`** — データ管理の仕組み
7. **`src/__tests__/hooks/useTodos.test.ts`** — そのテスト

**コツ:** ソースコードとテストコードを**横に並べて読む**と、テストが「ソースコードの使い方の見本」になっていることが分かります。

### ステップ4: テストを1つ追加してみる

慣れてきたら、自分でテストを1つ書いてみましょう。

たとえば `TodoList.test.tsx` に「メモ付きのToDoが表示されるか」というテストを追加するなら、既存のテストを真似て書いてみます。既存のテストをコピーして、少しだけ変えるところから始めると安全です。

### テストコードで使われているパターンの読み方

テストコードを読むときに知っておくと役立つパターンを3つだけ紹介します。

**パターン1: `expect(A).toBe(B)` — 「AがBと同じであることを期待する」**

```typescript
// todos配列の要素数が3であることを期待する
expect(result.current.todos).toHaveLength(3)
```

**パターン2: `vi.fn()` — 「呼ばれたかどうかを記録するダミー関数」**

```typescript
// ダミーの関数を作る
const onAdd = vi.fn()

// ボタンを押すとonAddが呼ばれるか確認
expect(onAdd).toHaveBeenCalledWith('買い物', '牛乳を買う')
```

**パターン3: `screen.getByText('文字')` — 「画面からその文字を探す」**

```typescript
// 画面に「ToDoがありません」という文字があることを確認
expect(screen.getByText('ToDoがありません')).toBeInTheDocument()
```

この3つのパターンで、今回のテストの大半が読めるようになります。

---

## まとめ

今回のテスト作業で行ったことを一言でまとめると:

> **「アプリの54個の機能が正しく動くことを、1秒で自動確認できる仕組みを作った」**

これにより:

- アプリを変更したとき、壊れた箇所がすぐ分かる
- 手動で全ページを確認する必要がなくなる
- テストコード自体が「この機能はこう動くべき」という仕様書になる

テストの価値は**アプリが成長するほど大きくなります**。今は小さなアプリですが、機能が増えるほど「テストがあってよかった」と実感するはずです。
